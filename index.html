<html> 
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<title>Tableau Voice Control1</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Creating Tabitha">
		<meta name="author" content="Jeffrey Shaffer">

		<script src="annyang.min.js"></script> <!-- Voice Recognition -->
		<script src="responsivevoice.js"></script> <!-- Voice Response -->
		
		<script src="https://public.tableausoftware.com/javascripts/api/tableau-2.min.js " type="text/javascript"></script> 

</head>	

<body onload=initializeViz();>
	<center><span style="font-size: 150%; display:inline;"><b>Tableau Voice Control</b></span></center>
	<img src="genpact logo.png" style="float:right">
	
<p style="float:left; display:inline;">
	<button type="button"; id="myBtn"; class="button">Enable voice!</button> <span style="font-size: 70%;">(use with chrome browser)</span>
	<br> Say : <br>
	<i>"Select Region Europe"  <br> "Add Region Africa" <br> "Select Region All" <br> 
		"Select year 2009 <br> (two thousand and nine)" <br> "Show Map View" <br> "Export PDF" <br> "start over"</i> </p>
	
<br>
<center><div id='tableauViz'></div></center>
<script> 
if (annyang) {
  // These are the voice commands in quotes followed by the function
  var commands = {
	'Select :measure *theValue' : filterSingleValue,
	'Add Region *tag': addValuesToFilter,
	'Show View *tag': switchToTab,  
	'Show Bar View': function() { switchToBarChart();  responsiveVoice.speak('Showing Bar View'); },  
	'Export PDF': function() { exportPDF();  responsiveVoice.speak('Exporting PDF'); },  
	'start over': function() { startover(); responsiveVoice.speak('starting over'); },
	//'Select year *tag' : filterYearValue 
	};

	document.getElementById("myBtn").addEventListener("click", function() {
  responsiveVoice.speak('Hi. Welcome to Tableau. How may I help you?');
  // Add commands to annyang
  annyang.addCommands(commands);
  
  // Start listening.
  annyang.start();
});

}

var viz, workbook, activeSheet, Worksheet, worksheet;
//Tabitha says hello
//responsiveVoice.speak('Hi. Welcome to Tableau. How may I help you?');
//alert('1');
	
function initializeViz(){

var placeholderDiv = document.getElementById("tableauViz");

//var url = "https://public.tableau.com/views/WorldIndicators/GDPpercapita";
//var url = "https://public.tableau.com/profile/danielv#!/vizhome/WorldIndicators_292/GDPpercapita";
//var url = "https://public.tableau.com/views/Starwars/StarWords";
//var url = "https://public.tableau.com/views/RegionalSampleWorkbook/College";
//var url = "https://public.tableau.com/profile/manish.agarwal7810#!/vizhome/RegionalSampleWorkbook_15766585181680/College";
var url = "https://public.tableau.com/views/RegionalSampleWorkbook_15766585181680/College?:display_count=y&:origin=viz_share_link";
var options = {
   width: "1004",   
   height: "869",
   hideTabs: false,
   hideToolbar: true,
  onFirstInteractive: function () {
  workbook = viz.getWorkbook();
  activeSheet = workbook.getActiveSheet();
}
};
  viz = new tableauSoftware.Viz(placeholderDiv, url, options);
}

//Make Character selection
function filterSingleValue(measure,value) {
	alert(measure);alert(value);
	//var pos=measurenvalue.indexOf(' ');
	//alert(pos);
	//var measure=measurenvalue.slice(0,pos);
	measure.trim();
	measure=measure.charAt(0).toUpperCase() + measure.slice(1);
	alert(measure);
	//var value=measurenvalue.slice(measurenvalue.indexOf(' ')+1);
	value.trim();
	value.initCap();
	alert(value);
	if (value == 'all') {
		workbook.getActiveSheet().clearFilterAsync(measure);
		responsiveVoice.speak('selecting Regions All', "UK English Male");
	}
	else {
		workbook.getActiveSheet().applyFilterAsync(
    		measure,
    		value,
    		tableau.FilterUpdateType.REPLACE);
		responsiveVoice.speak('selecting '+measure+' '+value, "UK English Male");
		//responsiveVoice.speak(region, "UK English Male");
	}
} 
//Make Year selection
function filterYearValue(v_year) {
	alert('year='+v_year);
	//activeSheet.applyFilterAsync(
	workbook.getActiveSheet().applyFilterAsync(
    	"YEAR(Date (year))",
    	v_year,
    	tableau.FilterUpdateType.REPLACE);
	responsiveVoice.speak('selecting year', "UK English Male");
	responsiveVoice.speak(v_year, "UK English Male");
} 

function switchToTab(vTab) {
  vTab.trim();
  vTab=vTab.charAt(0).toUpperCase() + vTab.slice(1);
  alert(vTab);
  workbook.activateSheetAsync(vTab);
  responsiveVoice.speak('Showing View', "UK English Male");
  responsiveVoice.speak(vTab, "UK English Male");
}  

function switchToBarChart() {
  workbook.activateSheetAsync("GDP per capita");
}  

function exportPDF() {
  viz.showExportPDFDialog();
}   

function clearFilters() {
  workbook.getActiveSheet().clearFilterAsync("Region");
}    

function addValuesToFilter(region) {
  	workbook.getActiveSheet().applyFilterAsync(
    		"Region",
		region,
		tableau.FilterUpdateType.ADD);
	responsiveVoice.speak('Adding', "UK English Male");
	responsiveVoice.speak(region, "UK English Male");

}    
	
//Start Viz Over
function startover()
{
	//switchToBarChart();
	viz.revertAllAsync();
}

String.prototype.capitalize = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
} 
String.prototype.initCap = function () {
	alert('in initCap');
    var new_str = this.split(' '),
        i,
        arr = [];
    for (i = 0; i < new_str.length; i++) {
        arr.push(initCap(new_str[i]).capitalize());
    }
    return arr.join(' ');
}

</script>

</body>
</html>		
